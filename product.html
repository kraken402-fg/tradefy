<!doctype html>
<html lang="fr">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Produit — Tradefy</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="assets/css/neon-theme.css">
    <link rel="stylesheet" href="assets/css/style.css">
    <script>
      // JSON-LD sera injecté dynamiquement par assets/js/main.js
    </script>
  </head>
  <body>
    <div class="container my-4">
      <a href="index.html">← Retour</a>
      <div id="productDetail" class="row mt-3">
        <div class="col-md-6" id="gallery"></div>
        <div class="col-md-6">
          <h2 id="title">Titre produit</h2>
          <p id="price" class="h4 text-success">$0.00</p>
          <p id="description">Description...</p>
          <button id="buyBtn" class="btn btn-neon">Acheter</button>
        </div>
      </div>

      <section class="mt-4">
        <h4>Avis</h4>
        <div id="reviews"></div>

        <hr/>
        <h5>Laisser un avis</h5>
        <form id="reviewForm">
          <div class="mb-2">
            <label>Note</label>
            <select id="rating" class="form-select">
              <option value="5">5</option>
              <option value="4">4</option>
              <option value="3">3</option>
              <option value="2">2</option>
              <option value="1">1</option>
            </select>
          </div>
          <div class="mb-2">
            <textarea id="comment" class="form-control" placeholder="Votre avis"></textarea>
          </div>
          <button class="btn btn-primary">Envoyer</button>
        </form>
      </section>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="assets/js/main.js"></script>
    <script>
      // Load product by id from query
      (async function(){
        const params = new URLSearchParams(location.search);
        const id = params.get('id');
        if(!id) return;
        const res = await fetch(`/api/products/${id}`);
        const data = await res.json();
        const p = data.product;
        document.getElementById('title').textContent = p.title;
        document.getElementById('price').textContent = `$${p.price}`;
        document.getElementById('description').textContent = p.description;
        const gallery = document.getElementById('gallery');
        gallery.innerHTML = p.images.map(src=>`<img src="${src}" class="img-fluid mb-2"/>`).join('');
        document.getElementById('reviews').innerHTML = (p.reviews||[]).map(r=>`<div class="mb-2"><strong>${r.rating}★</strong> — ${r.comment}</div>`).join('')

        // Inject JSON-LD Product + AggregateRating
        const ld = {
          '@context':'https://schema.org/',
          '@type':'Product',
          'name': p.title,
          'image': p.images || [],
          'description': p.description,
          'sku': p._id,
          'offers': { '@type':'Offer', 'priceCurrency':'USD', 'price': p.price }
        };
        const script = document.createElement('script');
        script.type='application/ld+json';
        script.textContent = JSON.stringify(ld);
        document.head.appendChild(script);
      })();
    </script>
  </body>
</html>
